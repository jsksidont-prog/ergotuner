<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>ERGOTUNER GITAR</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
 body{
   font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
   text-align: center;
   margin: 20px;
   background: 
     linear-gradient(rgba(255,255,255,0.6)), 
     url("ANDIDONT.png") no-repeat center center fixed;
   background-size: cover;
   background-attachment: scroll; 
   color: #000000;
 }

 h1{
   margin-bottom:10px; 
   font-size: 40px;
   padding-bottom: 1px;
   text-align: center;
   margin-top: 50px;
   font-weight: bolder;
 }

 #note{ font-size:50px; font-weight:bold; margin:10px 0 }
 #freq{ font-size:17px; color:#111 }
 button{
  margin-top:15px;
  padding:9px 30px;
  font-size:14px;
  cursor:pointer;
  border:1px solid #000;
  background:#eee;
  border-radius:8px
 }
 #pesan{margin-top:25px;color:rgb(255, 0, 0);font-size:15px}

 .note-emoji {
    position: fixed;
    font-size: 40px;
    animation: fall 2.5s linear forwards;
    pointer-events: none;
    z-index: 9999;
  }
  @keyframes fall {
    0% { transform: translateY(0) rotate(0deg); opacity: 1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
  }

 .hamburger-wrap{
   position: fixed;
   top: 14px;
   left: 14px;
   z-index: 60;
 }
 .hamburger{
   width:40px; height:32px;
   background:#fff;
   border:1px solid #ccc;
   border-radius:6px;
   display:flex; align-items:center; justify-content:center;
   cursor:pointer;
 }
 .hamburger .bar{
   width:20px; height:2px; background:#000;
   position:relative;
 }
 .hamburger .bar::before,
 .hamburger .bar::after{
   content:"";
   position:absolute;
   left:0; width:20px; height:2px; background:#000;
 }
 .hamburger .bar::before{ top:-6px; }
 .hamburger .bar::after{ top:6px; }

 .overlay{
   position:fixed; inset:0;
   background:rgba(0,0,0,0.4);
   opacity:0; pointer-events:none;
   transition:0.2s;
   z-index:50;
 }
 .overlay.show{ opacity:1; pointer-events:auto; }

 .menu-panel{
   position: fixed;
   top: 0; left: 0;
   width:220px;
   height:100%;
   background:#fff;
   box-shadow:2px 0 10px rgba(0,0,0,0.3);
   transform:translateX(-100%);
   transition:0.3s;
   z-index:55;
   padding-top:60px;
   text-align:left;
 }
 .menu-panel.show{ transform:translateX(0); }
 .menu-item{
   display:block;
   padding:12px 18px;
   text-decoration:none;
   color:#000;
   border-radius:6px;
   transition:0.3s;
   font-size:16px;
 }
 .menu-item:hover{ background:#f76c6c; color:#fff; }
</style>
</head>
<body>

<!-- MENU HAMBURGER -->
<div class="hamburger-wrap">
  <div class="hamburger" id="hambtn">
    <span class="bar"></span>
  </div>
</div>
<div class="overlay" id="overlay"></div>
<nav id="menuPanel" class="menu-panel">
  <a class="menu-item" href="index.html">Home</a>
  <a class="menu-item" href="h.html">Chord</a>
  <a class="menu-item" href="1312.html">Guide</a>
  <a class="menu-item" href="metro.html">Metronom</a>
  <a class="menu-item" href="TAB.html">Tab Maker</a>
  <a class="menu-item" href="tolerasi.html" style=color:red>STOP BULLYING & RACISM</a>
  <a class="menu-item" href="https://craftpix.net/?s=FARM">Download my App</a>
</nav>
<!-- END MENU -->

<h1 style="display: flex;margin-top:28px;align-items: center;justify-content: center;flex-wrap: wrap;">
  <img src="ERGOPANTEK.png" width="90" style="align-items: center;">
  <span style="margin-left:10px ;font-size:40px;align-items: center">ERGOTUNER GITAR</span>
</h1>

<div style="margin-top: 50px;">
    <div id="note">-</div>
    <div id="freq">- Hz</div>
    <button id="tombol" style="margin-top:15px; padding:12px 25px; font-size:18px; color:#eee; background-color:#4CAF50; border:0px; border-radius:8px; cursor:pointer;">
      HAYUKKK!
    </button>
 </div>

<div id="pesan"></div>

<div id="bar-wrap" style="margin:20px auto; width:300px; height:20px; background:#ddd; border-radius:10px; overflow:hidden;">
  <div id="bar" style="height:100%; width:50%; background:#4CAF50; transition:0.1s;"></div>
</div>
<div style="font-size:14px; margin-top:5px;">‚Üê Flat | Sharp ‚Üí</div>


<footer style="margin-top:80px;font-size:13px;color:#444;display:flex;flex-direction:column;align-items:center;text-align:center;">
    <div style="margin-bottom:8px;">
      <img  src="ERGOPANTEK.png" width="60" alt="Logo Ergo">
    </div>
    <span style="font-weight:bold; font-size: 15px;">¬© ERGOISME 2025</span>
    <a href="masukan.html" 
   style="text-decoration:none;font-size:13px; margin-top:5px; align-self:flex-start;">
   kirim masukan
</a>

</footer>

<script>
/* === LOGIKA MENU === */
const hambtn = document.getElementById('hambtn');
const menu = document.getElementById('menuPanel');
const overlay = document.getElementById('overlay');

hambtn.onclick = ()=>{ menu.classList.add('show'); overlay.classList.add('show'); };
overlay.onclick = ()=>{ menu.classList.remove('show'); overlay.classList.remove('show'); };
document.addEventListener('keydown',(e)=>{ if(e.key==="Escape"){ menu.classList.remove('show'); overlay.classList.remove('show'); }});

/* === LOGIKA TUNER === */
var audiokonteks,mic,kawegelombang,simpanreweng; 
var nada=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];
let nadasebelumnya=null, waktuakhir=0;

document.getElementById("tombol").onclick= async function(){
 if(audiokonteks) return;
 try{
   audiokonteks=new (window.AudioContext||window.webkitAudioContext)();
   if(audiokonteks.state==="suspended"){ await audiokonteks.resume(); }
   let stream=await navigator.mediaDevices.getUserMedia({audio:true});
   mic=audiokonteks.createMediaStreamSource(stream);
   kawegelombang=audiokonteks.createAnalyser(); kawegelombang.fftSize=2048;
   simpanreweng=new Float32Array(kawegelombang.fftSize);
   mic.connect(kawegelombang);
   this.disabled=true; this.innerText="dengeeee...";
   document.getElementById("pesan").innerText="";
   lako()
 }catch(e){
   document.getElementById("pesan").innerText="OE!!! pande izin mic e: "+e.message;
   audiokonteks=null
 }
}

function lako(){
 kawegelombang.getFloatTimeDomainData(simpanreweng);
 let frekuensi=korelasi(simpanreweng,audiokonteks.sampleRate);
if(frekuensi>0){
  let angkaMIDI = Math.round(12*Math.log(frekuensi/440)/Math.log(2)+69);
  let namanada = nada[((angkaMIDI%12)+12)%12]; 
  let oktaf = Math.floor(angkaMIDI/12)-1; 
  let hasil = namanada+oktaf;

  let freqTarget = 440 * Math.pow(2, (angkaMIDI-69)/12);
  let cents = 1200*Math.log(frekuensi/freqTarget)/Math.log(2); 

  let now = performance.now();
  if(nadasebelumnya==null||hasil!=nadasebelumnya||now-waktuakhir>1200){
     nadasebelumnya=hasil; waktuakhir=now;
     document.getElementById("note").innerText=hasil;
     document.getElementById("freq").innerText=frekuensi.toFixed(1)+" Hz";
  }
  updateBar(cents);
}
 setTimeout(lako,55)
}

function korelasi(b,r){
 var sz=b.length,rms=0;
 for(let i=0;i<sz;i++){ rms+=b[i]*b[i]; }
 rms=Math.sqrt(rms/sz);
 if(rms<0.01) return 0;
 var r1=0,r2=sz-1,thr=0.2;
 for(let i=0;i<sz/2;i++){ if(Math.abs(b[i])<thr){r1=i;break;} }
 for(let i=1;i<sz/2;i++){ if(Math.abs(b[sz-i])<thr){r2=sz-i;break;} }
 b=b.slice(r1,r2); sz=b.length;
 let c=new Array(sz).fill(0);
 for(var i=0;i<sz;i++){ for(var j=0;j<sz-i;j++){ c[i]+=b[j]*b[j+i]; } }
 let d=0; while(c[d]>c[d+1]) d++;
 let mv=-1,p=-1;
 for(var i=d;i<sz;i++){ if(c[i]>mv){ mv=c[i]; p=i; } }
 if(p==-1)return 0;
 return r/p
}

document.body.addEventListener("click", function(e){
  if(e.target.tagName === "BUTTON") return;
  const emojis = ["üéµ","üé∂","üéº"];
  for(let i=0; i<3; i++){
    let span = document.createElement("span");
    span.className = "note-emoji";
    span.innerText = emojis[Math.floor(Math.random() * emojis.length)];
    span.style.left = Math.random() * window.innerWidth + "px";
    span.style.top = "-40px";
    span.style.fontSize = (30 + Math.random()*30) + "px";
    document.body.appendChild(span);
    setTimeout(()=>{ span.remove(); }, 2500);
  }
});

function updateBar(cents){
  let bar = document.getElementById("bar");
  if(!bar) return;
  let percent = Math.max(0, Math.min(100, 50 + cents));
  bar.style.width = percent + "%";
  bar.style.background = Math.abs(cents)<5 ? "limegreen":"#4CAF50";
}
</script>

</body>
</html>
